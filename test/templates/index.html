<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f5f5;
        }
        
        body {
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }
        
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        .dark-mode .card {
            background-color: #2d2d2d;
            border-color: #404040;
        }
        
        .dark-mode .table {
            color: #ffffff;
        }
        
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 10px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.3);
            border-color: var(--primary-color);
        }
        
        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table thead th {
            background-color: var(--secondary-color);
            border-bottom: 2px solid #ddd;
        }
        
        .dark-mode .table thead th {
            background-color: #404040;
            border-bottom-color: #505050;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .dark-mode .loading {
            background: rgba(0, 0, 0, 0.8);
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .select2-container--bootstrap-5 .select2-selection {
            border-radius: 8px;
        }
        
        .dark-mode .select2-container--bootstrap-5 .select2-selection {
            background-color: #2d2d2d;
            border-color: #404040;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
    </div>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="animate__animated animate__fadeIn">{{ app_name }}</h1>
            <button id="darkModeToggle" class="btn btn-outline-primary">
                <i class="fas fa-moon"></i> Toggle Dark Mode
            </button>
        </div>
        <h1>{{ app_name }}</h1>
        
        <!-- Create Form -->
        <div class="card mb-4">
            <div class="card-header">
                <h2>Create New Record</h2>
            </div>
            <div class="card-body">
                <form action="{{ url_for('create_record') }}" method="POST">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>

                    {% for field_id, field in meta_fields.items() %}
                    <div class="mb-3">
                        <label for="{{ field_id }}" class="form-label">{{ field.name }}</label>
                        <select class="form-select {% if field.multiple %}select2-multiple{% else %}select2-single{% endif %}" 
                                id="{{ field_id }}" 
                                name="{{ field_id }}"
                                {% if field.multiple %}multiple{% endif %}
                                required>
                            {% if not field.multiple %}
                                <option value="">Select {{ field.name }}</option>
                            {% endif %}
                            {% for option in field.options %}
                                <option value="{{ option }}">{{ option }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endfor %}

                    <button type="submit" class="btn btn-primary">Create Record</button>
                </form>
            </div>
        </div>

        <!-- Records List -->
        <div class="card">
            <div class="card-header">
                <h2>Records</h2>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                {% for field_id, field in meta_fields.items() %}
                                <th>{{ field.name }}</th>
                                {% endfor %}
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in records %}
                            <tr>
                                <td>{{ record.name }}</td>
                                {% for field_id, field in meta_fields.items() %}
                                <td>
                                    {% if field.multiple %}
                                        {{ record.get(field_id, [])|join(', ') }}
                                    {% else %}
                                        {{ record.get(field_id, '') }}
                                    {% endif %}
                                </td>
                                {% endfor %}
                                <td>{{ record.created_at }}</td>
                                <td>
                                    <a href="{{ url_for('delete_record', record_id=record._id) }}" 
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('Are you sure you want to delete this record?')">
                                        Delete
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            $('.select2-single').select2({
                theme: 'bootstrap-5'
            });
            $('.select2-multiple').select2({
                theme: 'bootstrap-5',
                placeholder: 'Select options'
            });

            // Dark mode toggle
            $('#darkModeToggle').click(function() {
                $('body').toggleClass('dark-mode');
                localStorage.setItem('darkMode', $('body').hasClass('dark-mode'));
            });

            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                $('body').addClass('dark-mode');
            }

            // Show loading animation on form submit
            $('form').on('submit', function() {
                $('#loading').fadeIn();
            });

            // Animate new elements
            $('.card').addClass('animate__animated animate__fadeIn');
            
            // Smooth scroll to top after delete
            $('.btn-danger').click(function() {
                if(confirm('Are you sure you want to delete this record?')) {
                    $('#loading').fadeIn();
                    $('html, body').animate({ scrollTop: 0 }, 'slow');
                    return true;
                }
                return false;
            });

            // Hide loading animation on page load
            $('#loading').fadeOut();
        });
    </script>
</body>
</html>
